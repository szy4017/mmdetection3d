# 验证安装的demo运行命令
python demo/pcd_demo.py demo/data/kitti/000008.bin \
    configs/pointpillars/pointpillars_hv_secfpn_8xb6-160e_kitti-3d-car.py \
    checkpoints/hv_pointpillars_secfpn_6x8_160e_kitti-3d-car_20220331_134606-d42d15ed.pth --show

# 点云分割的可视化demo，必须要cuda，cpu上无法可视化
python demo/pcd_seg_demo.py demo/data/scannet/scene0000_00.bin \
    configs/pointnet2/pointnet2_ssg_2xb16-cosine-50e_s3dis-seg.py \
    checkpoints/pointnet2_ssg_xyz-only_16x2_cosine_200e_scannet_seg-3d-20class_20210514_143628-4e341a48.pth --show

# point++在s3dis上的test
python tools/test.py configs/pointnet2/pointnet2_ssg_2xb16-cosine-50e_s3dis-seg.py \
    checkpoints/pointnet2_ssg_16x2_cosine_50e_s3dis_seg-3d-13class_20210514_144205-995d0119.pth \
    --task lidar_seg

# minkunet demo
python demo/pcd_seg_demo.py \
    points/000000_point_feature.npy \
    configs/minkunet/minkunet34v2_w32_torchsparse_8xb2-amp-laser-polar-mix-3x_semantickitti.py \
    checkpoints/minkunet34v2_w32_torchsparse_8xb2-amp-laser-polar-mix-3x_semantickitti_20230510_221853-b14a68b3.pth \

# semantickitti数据集生成命令
python ./tools/create_data.py semantickitti --root-path ./data/semantickitti --out-dir ./data/semantickitti --extra-tag semantickitti
# kitti_instance数据集生成命令
python ./tools/create_data_mine.py kittiinstance --root-path ./data/kitti_instance_seg --out-dir ./data/kitti_instance_seg --extra-tag kittiinstance

# 在semantickitti上评估MinkUNet
bash tools/dist_test.sh configs/minkunet/minkunet_w32_8xb2-15e_semantickitti.py checkpoints/minkunet_w32_8xb2-15e_semantickitti_20230309_160710-7fa0a6f1.pth 8
bash tools/dist_test.sh configs/minkunet/minkunet34_w32_spconv_8xb2-laser-polar-mix-3x_semantickitti.py checkpoints/minkunet34_w32_spconv_8xb2-laser-polar-mix-3x_semantickitti_20230512_233817-72b200d8.pth 4
python tools/test.py configs/minkunet/minkunet34_w32_spconv_8xb2-laser-polar-mix-3x_semantickitti.py checkpoints/minkunet34_w32_spconv_8xb2-laser-polar-mix-3x_semantickitti_20230512_233817-72b200d8.pth --task lidar_seg
# 在kitti_instance_seg上评估MinkUNet
python tools/test.py work_dirs/minkunet34_w32_spconv_8xb2-laser-polar-mix-3x_kittiinstanceseg_mine/minkunet34_w32_spconv_8xb2-laser-polar-mix-3x_kittiinstanceseg_mine.py checkpoints/munkunet_kittiinstance_20230715_1829.pth --task lidar_seg

# 在kittiinstance上微调MinkUNet，直接训练
python tools/train.py configs/minkunet/minkunet34_w32_spconv_8xb2-laser-polar-mix-3x_kittiinstanceseg_mine.py

# waymo数据集转换命令
python tools/create_data.py waymo --root-path ./data/waymo/ --out-dir ./data/waymo/ --workers 128 --extra-tag waymo

# waymo_mine数据集生成命令
python tools/create_data_mine.py waymomine --root-path ./data/waymo_mine --out-dir ./data/waymo_mine --extra-tag waymo_mine

# 在waymo_mine数据集上评估SECOND
python tools/test.py configs/second/second_hv_secfpn_8xb6-80e_waymomine-3d-3class_mine.py checkpoints/hv_second_secfpn_fp16_6x8_80e_kitti-3d-3class_20200925_110059-05f67bdf.pth

# 在waymo_mine数据集上训练SECOND
CUDA_VISIBLE_DEVICES=0,2,3,4 ./tools/dist_train.sh configs/second/second_hv_secfpn_8xb6-80e_waymomine-3d-3class_mine.py 4

# kitti数据集生成命令
python tools/create_data.py kitti --root-path ./data/kitti --out-dir ./data/kitti --extra-tag kitti

# 在kitti数据集上评估Centerpoint
python tools/test.py configs/centerpoint/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine.py checkpoints/centerpoint_01voxel_second_secfpn_circlenms_4x8_cyclic_20e_nus_20220810_030004-9061688e.pth
python tools/test.py work_dirs/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine.py work_dirs/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine/epoch_20.pth
python tools/test.py work_dirs/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine.py \
    checkpoints/centerpoint_01voxel_second_secfpn_circlenms_4x8_cyclic_20e_kitti_20230831_164304_mine.pth
# 在kitti数据集上评估SECOND
python tools/test.py configs/second/second_hv_secfpn_8xb6-80e_kitti-3d-3class.py checkpoints/second_hv_secfpn_8xb6-80e_kitti-3d-3class_mine.pth

# 在kitti数据集上训练Centerpoint
CUDA_VISIBLE_DEVICES=0,2,3,4 ./tools/dist_train.sh configs/centerpoint/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine.py 4

# 绘制centerpoint在kitti训练的loss曲线
python tools/analysis_tools/analyze_logs.py plot_curve work_dirs/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine/20230830_155751/vis_data/20230830_155751.json --keys loss --legend loss --out centerpoint-kitti-loss.png
python tools/analysis_tools/analyze_logs.py plot_curve work_dirs/centerpoint_voxel01_second_secfpn_8xb4-cyclic-20e_kitti-3d_mine/20230831_164304/vis_data/20230831_164304.json \
    --keys Pedestrian_3D_AP11_easy_strict Car_3D_AP11_easy_strict Cyclist_3D_AP11_easy_strict \
    --legend pedes_AP11_easy car_AP11_easy cyclist_AP11_easy --eval --out centerpoint-kitti-3class-AP11-easy.png

# 可视化训练模型的预测结果 SECOND in KITTI
python tools/test.py configs/second/second_hv_secfpn_8xb6-80e_kitti-3d-3class.py checkpoints/second_hv_secfpn_8xb6-80e_kitti-3d-3class_mine.pth --cfg-options pklfile_prefix=./work_dirs/results
python demo/pcd_demo.py demo/data/kitti/000008.bin configs/second/second_hv_secfpn_8xb6-80e_kitti-3d-3class.py checkpoints/second_hv_secfpn_8xb6-80e_kitti-3d-3class_mine.pth --show --snapshot --out-dir ./work_dirs/results
python tools/test.py configs/second/second_hv_secfpn_8xb6-80e_kitti-3d-3class.py checkpoints/second_hv_secfpn_8xb6-80e_kitti-3d-3class_mine.pth --show --show-dir ./work_dirs/results --task lidar_det
python demo/pcd_demo_mine.py data/kitti/training/velodyne/007396.bin configs/second/second_hv_secfpn_8xb6-80e_kitti-3d-3class.py checkpoints/second_hv_secfpn_8xb6-80e_kitti-3d-3class_mine.pth
